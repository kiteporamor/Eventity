FROM mcr.microsoft.com/dotnet/sdk:6.0

WORKDIR /src

COPY ./src/ .

ENV NUGET_XMLDOC_MODE=skip
ENV DOTNET_CLI_TELEMETRY_OPTOUT=1
ENV DOTNET_SKIP_FIRST_TIME_EXPERIENCE=1

WORKDIR /src/Eventity.Tests.E2E.FA

RUN find . -name "*.feature.cs" -delete 2>/dev/null || true
RUN rm -rf obj bin 2>/dev/null || true

RUN dotnet restore --force

RUN dotnet build --verbosity minimal /p:GenerateSpecFlowBindings=true

CMD ["dotnet", "test", "--logger", "console;verbosity=normal"]